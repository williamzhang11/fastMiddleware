# zookeeper文件系统

zookeeper提供了
1、文件系统。

2、通知机制。

## Zookeeper 的文件系统是什么

Zookeeper 提供一个多层级的节点命名空间(节点称为 znode)。一个znode节点可以包含子znode,同时也可以包含数据

zk的文件系统和Linux的文件系统目录结构一样，从"/"开始

zk的访问路径只有绝对路径，没有相对路径。

zk中没有文件和目录的概念，只有znode节点，Znode既有文件的功能，又有目录的功能

Zookeeper 为了保证高吞吐和低延迟，在内存中维护了这个树状的目录结构，这种特性使得 Zookeeper
 不能用于存放大量的数据，每个节点的存放数据上限为 1M 
 
 
https://blog.csdn.net/qichangjian/article/details/88184705
 
### Zookeeper 有哪几种节点类型

1.PERSISTENT 持久节点

创建之后一直存在，除非有删除操作，创建节点的客户端会话失效也不影响此节点。

2.PERSISTENT_SEQUENTIAL 持久顺序节点

跟持久一样，就是父节点在创建下一级子节点的时候，记录每个子节点创建的先后顺序，会给每个子节点名加上一个数字后缀。

3.EPHEMERAL 临时节点

创建客户端会话失效（注意是会话失效，不是连接断了），节点也就没了。不能建子节点。

4.EPHEMERAL_SEQUENTIAL 临时顺序节点

基本特性同临时节点，增加了顺序属性，节点名后边会追加一个由父节点维护的自增整型数字

zookeeper的znode的相关特点：

创建znode时设置顺序标识，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护。（无论创建的是否是有编号节点，都为顺序递增）

EPHEMERAL 临时类型的节点不能有子节点

对于zk来说，它的znode中储存的数据不能超过1M，最好不要超过1KB，如果数据量比较大，很难保证数据的一致性

对于zk来说，有几个节点数据就会存储几份




## Zookeeper 的通知机制是什么

Zookeeper 允许客户端向服务端的某个 znode 注册一个 Watcher 监听，当服务端的一些指定事
件触发了这个 Watcher ，服务端会向指定客户端发送一个事件通知来实现分布式的通知功能，然后
客户端根据 Watcher 通知状态和事件类型做出业务上的改变。

第一步，客户端注册 Watcher 。

第二步，服务端处理 Watcher 。

第三步，客户端回调 Watcher 。

触发的四种方式：

```
Znode的创建----nodeCreated
Znode 被删除---nodeDelete
Znode的数据变化---nodedatachanged
Znode的子节点的变化----nodeChildrenchange
```
监听只生效一次


## Zookeeper 的会话管理是怎么样的

ZooKeeper 的每个客户端都维护一组服务端信息，在创建连接时由应用指定，客户端随机选择一个服务
端进行连接，连接成功后，服务端为每个连接分配一个唯一标识。

客户端在创建连接时可以指定溢出时间，客户端会周期性的向服务端发送 PING 请求来保持连接


如果客户端异常下线，或者网络问题，导致一段时间没心跳给 Zookeeper 服务端，
则会被 Zookeeper 标记为下线。

当客户端检测到与服务端断开连接后，客户端将自动选择服务端列表中的另一个服务端进行重连。
客户端允许应用修改服务端列表，但修改可能导致客户端与服务端的重连。


