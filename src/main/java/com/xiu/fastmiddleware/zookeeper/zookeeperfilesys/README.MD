# zookeeper文件系统

zookeeper提供了
1、文件系统。

2、通知机制。

## Zookeeper 的文件系统是什么

Zookeeper 提供一个多层级的节点命名空间(节点称为 znode)。与文件系统不同的是，这些节点
都可以设置关联的数据，而文件系统中只有文件节点可以存放数据而目录节点不行。

Zookeeper 为了保证高吞吐和低延迟，在内存中维护了这个树状的目录结构，这种特性使得 Zookeeper
 不能用于存放大量的数据，每个节点的存放数据上限为 1M 
 
### Zookeeper 有哪几种节点类型

1.PERSISTENT 持久节点

创建之后一直存在，除非有删除操作，创建节点的客户端会话失效也不影响此节点。

2.PERSISTENT_SEQUENTIAL 持久顺序节点

跟持久一样，就是父节点在创建下一级子节点的时候，记录每个子节点创建的先后顺序，会给每个子节点名加上一个数字后缀。

3.EPHEMERAL 临时节点

创建客户端会话失效（注意是会话失效，不是连接断了），节点也就没了。不能建子节点。

4.EPHEMERAL_SEQUENTIAL 临时顺序节点

基本特性同临时节点，增加了顺序属性，节点名后边会追加一个由父节点维护的自增整型数字


## Zookeeper 的通知机制是什么

Zookeeper 允许客户端向服务端的某个 znode 注册一个 Watcher 监听，当服务端的一些指定事
件触发了这个 Watcher ，服务端会向指定客户端发送一个事件通知来实现分布式的通知功能，然后
客户端根据 Watcher 通知状态和事件类型做出业务上的改变。

第一步，客户端注册 Watcher 。

第二步，服务端处理 Watcher 。

第三步，客户端回调 Watcher 。

## Zookeeper 的会话管理是怎么样的

ZooKeeper 的每个客户端都维护一组服务端信息，在创建连接时由应用指定，客户端随机选择一个服务
端进行连接，连接成功后，服务端为每个连接分配一个唯一标识。

客户端在创建连接时可以指定溢出时间，客户端会周期性的向服务端发送 PING 请求来保持连接


如果客户端异常下线，或者网络问题，导致一段时间没心跳给 Zookeeper 服务端，
则会被 Zookeeper 标记为下线。

当客户端检测到与服务端断开连接后，客户端将自动选择服务端列表中的另一个服务端进行重连。
客户端允许应用修改服务端列表，但修改可能导致客户端与服务端的重连。


