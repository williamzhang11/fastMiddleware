# redis的2种持久化方式

Redis 提供了两种方式，实现数据的持久化到硬盘

1、【全量】RDB 持久化，是指在指定的时间间隔内将内存中的数据集快照写入磁盘。实际操作过程是，
fork 一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。


2、【增量】AOF持久化，以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，
以文本的方式记录，可以打开文件看到详细的操作记录。

## 1.RDB持久化

### 优点

(1)灵活设置备份频率和周期
	
(2)非常适合冷备份，对于灾难恢复而言，RDB 是非常不错的选择
	
(3)性能最大化.对于 Redis 的服务进程而言，在开始持久化时，它唯一需要做的只是 fork 出子进程，
之后再由子进程完成这些持久化的工作，这样就可以极大的避免服务进程执行 IO 操作了。也就是说，
RDB 对 Redis 对外提供的读写服务，影响非常小，可以让 Redis 保持高性能。
	
(4)恢复更快。相比于 AOF 机制，RDB 的恢复速度更更快，更适合恢复数据，特别是在数据集非常大的情况
	
### 缺点

(1)如果你想保证数据的高可用性，即最大限度的避免数据丢失，那么 RDB 将不是一个很好的选择。
因为系统一旦在定时持久化之前出现宕机现象，此前没有来得及写入磁盘的数据都将丢失。

	RDB 实际场景下，需要和 AOF 一起使用
	
(2)由于 RDB 是通过 fork 子进程来协助完成数据持久化工作的，因此，如果当数据集较大时，
可能会导致整个服务器停止服务几百毫秒，甚至是 1 秒钟。

所以，RDB 建议在业务低估，例如在半夜执行。

## AOF

###  优点

(1)该机制可以带来更高的数据安全性，即数据持久性.Redis 中提供了 3 种同步策略，即每秒同步、
每修改(执行一个命令)同步和不同步。

事实上，每秒同步也是异步完成的，其效率也是非常高的，所差的是一旦系统出现宕机现象，
那么这一秒钟之内修改的数据将会丢失。

而每修改同步，我们可以将其视为同步持久化，即每次发生的数据变化都会被立即记录到磁盘中。
可以预见，这种方式在效率上是最低的。
	
(2)由于该机制对日志文件的写入操作采用的是 append 模式，
因此在写入过程中即使出现宕机现象，也不会破坏日志文件中已经存在的内容	

因为以 append-only 模式写入，所以没有任何磁盘寻址的开销，写入性能非常高

另外，如果我们本次操作只是写入了一半数据就出现了系统崩溃问题，不用担心，
在 Redis 下一次启动之前，我们可以通过 redis-check-aof 工具来帮助我们解决数据一致性的问题。

## 缺点

(1)对于相同数量的数据集而言，AOF 文件通常要大于 RDB 文件。RDB 在恢复大数据集
时的速度比 AOF 的恢复速度要快


## 如何选择

Redis 支持同时开启开启两种持久化方式，我们可以综合使用 AOF 和 RDB 两种持久化机制，
用 AOF 来保证数据不丢失，作为数据恢复的第一选择; 用 RDB 来做不同程度的冷备，
在 AOF 文件都丢失或损坏不可用的时候，还可以使用 RDB 来进行快速的数据恢复。


	

















